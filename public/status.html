<!doctype html>
<html>
<head><meta charset="utf-8"><title>Requesthub â€” Status</title></head>
<body style="font-family:system-ui, Arial; padding:20px; max-width:720px;">
<div id="out">Loading...</div>
<script>
const token = new URLSearchParams(location.search).get('token');
const out = document.getElementById('out');
if (!token) out.innerText = 'No token provided.';
else {
  async function load(){
    const r = await fetch('/api/status?token=' + encodeURIComponent(token));
    const j = await r.json();
    if (j.error) { out.innerText = 'Error: ' + j.error; return; }
    out.innerHTML = `<h2>Request status</h2>
      <b>Token:</b> ${j.token}<br>
      <b>Name:</b> ${j.name}<br>
      <b>Purpose:</b> ${j.purpose}<br>
      <b>Status:</b> ${j.status}<br>
      <b>Labels:</b> ${ (j.labels||[]).join(', ') }<br>
      <h3>Message</h3><pre>${j.body}</pre>`;
  }
  load();
  const es = new EventSource('/events');
  es.onmessage = e => {
    const msg = JSON.parse(e.data);
    if ((msg.type === 'status_update' && msg.token === token) || (msg.type === 'comment' && msg.token === token)) load();
  };
}
</script>
</body>
</html>
